<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Always Hot Deluxe - 3x3</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="script.js"></script>
    <style>
        .slot-machine-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .win-counter {
            font-size: 3em;
            color: gold;
            font-weight: bold;
            margin-right: 20px;
            display: none;
        }

        .slot-machine {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .reel {
            font-size: 2em;
            margin: 0 10px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ffa500;
            background-color: #333;
            color: #ffa500;
        }

        h1 {
            color: orange;
        }

        body {
            background-color: #333;
            color: #ffa500;
            text-align: center;
        }

        .controls {
            margin-top: 20px;
        }

        .controls select, .controls button {
            margin-left: 5px;
        }

        .win {
            background-color: #ff4500;
        }
    </style>
</head>
<body>
    <h1>Always Hot Deluxe - 3x3</h1>

    <div class="slot-machine-container">
        <div id="win-counter" class="win-counter"></div>

        <div class="slot-machine">
            <div class="row" id="row1">
                <div class="reel" id="reel1"></div>
                <div class="reel" id="reel2"></div>
                <div class="reel" id="reel3"></div>
            </div>
            <div class="row" id="row2">
                <div class="reel" id="reel4"></div>
                <div class="reel" id="reel5"></div>
                <div class="reel" id="reel6"></div>
            </div>
            <div class="row" id="row3">
                <div class="reel" id="reel7"></div>
                <div class="reel" id="reel8"></div>
                <div class="reel" id="reel9"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <label for="bet">Zak≈Çad za obr√≥t (5 linii):</label>
        <select id="bet">
            <option value="5">5 z≈Ç</option>
            <option value="15" selected>15 z≈Ç</option>
            <option value="20">20 z≈Ç</option>
            <option value="50">50 z≈Ç</option>
            <option value="100">100 z≈Ç</option>
        </select>

        <button id="add-money-button">Dodaj kredyty</button>
        <button id="spin-button">Spin</button>
        <p>Saldo: <span id="money-counter">100</span> PLN</p>
        <p id="result-message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reels = [
                document.getElementById('reel1'),
                document.getElementById('reel2'),
                document.getElementById('reel3'),
                document.getElementById('reel4'),
                document.getElementById('reel5'),
                document.getElementById('reel6'),
                document.getElementById('reel7'),
                document.getElementById('reel8'),
                document.getElementById('reel9')
            ];

            const spinButton = document.getElementById('spin-button');
            const addMoneyButton = document.getElementById('add-money-button');
            const resultMessage = document.getElementById('result-message');
            const moneyCounter = document.getElementById('money-counter');
            const betSelect = document.getElementById('bet');
            const winCounter = document.getElementById('win-counter'); 

            const basePayouts = {
                'X': 15,
                'üçíüçãüçáüçä': 120, 
                'BAR': 180,
                '‚≠ê': 600, 
                '7Ô∏è‚É£': 2250 
            };

            const symbols = [
                { icon: 'üçí', points: basePayouts['üçíüçãüçáüçä'] },
                { icon: 'üçã', points: basePayouts['üçíüçãüçáüçä'] },
                { icon: 'üçá', points: basePayouts['üçíüçãüçáüçä'] },
                { icon: 'üçä', points: basePayouts['üçíüçãüçáüçä'] },
                { icon: 'BAR', points: basePayouts['BAR'] },
                { icon: '‚≠ê', points: basePayouts['‚≠ê'] },
                { icon: '7Ô∏è‚É£', points: basePayouts['7Ô∏è‚É£'] },
                { icon: 'X', points: basePayouts['X'] }
            ];

            let balance = 100;

            function updateMoneyCounter() {
                moneyCounter.textContent = balance.toFixed(2);
            }

            function adjustForRTP(results, rtp) {
                const winChance = rtp / 100;
                if (Math.random() <= winChance) {
                    const winSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                    const winningLine = [0, 1, 2]; 
                    winningLine.forEach(index => {
                        results[index] = winSymbol;
                    });
                } else {
                    results.forEach((_, index) => {
                        const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                        results[index] = randomSymbol;
                    });
                }
                return results;
            }

            function spinReels() {
                let results = Array(reels.length).fill(null);
                results = adjustForRTP(results, 95.17);

                reels.forEach((reel, index) => {
                    reel.textContent = results[index].icon;
                });

                return results;
            }

            function calculatePayout(bet, basePayout) {
                return (basePayout / 15) * bet;
            }

            function checkWin(results) {
                const winLines = [
                    [0, 1, 2],
                    [3, 4, 5],
                    [6, 7, 8],
                    [0, 4, 8],
                    [2, 4, 6]
                ];

                const bet = parseInt(betSelect.value);
                let winAmount = 0;
                let winningSymbols = [];

                winLines.forEach(line => {
                    const [a, b, c] = line;
                    if (results[a].icon === results[b].icon && results[b].icon === results[c].icon) {
                        const payout = calculatePayout(bet, results[a].points);
                        winAmount += payout;
                        winningSymbols.push(reels[a], reels[b], reels[c]);
                    }
                });

                return { winAmount, winningSymbols };
            }

            function animateReels() {
                const tl = gsap.timeline(); 
                reels.forEach((reel, index) => {
                    tl.to(reel, {
                        y: -100, 
                        duration: 0.1, 
                        repeat: 10, 
                        ease: "none",
                        onRepeat: () => {
                            const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                            reel.textContent = randomSymbol.icon;
                        },
                        onComplete: () => {
                            const finalSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                            reel.textContent = finalSymbol.icon;
                            gsap.set(reel, { y: 0 });
                        }
                    }, index * 0.1);
                });
                return tl;
            }

            function animateWinningSymbols(winningSymbols) {
                winningSymbols.forEach(symbol => {
                    gsap.to(symbol, { 
                        scale: 1.5, 
                        repeat: 3, 
                        yoyo: true, 
                        duration: 0.3,
                        backgroundColor: "#ff4500"
                    });
                });
            }

            spinButton.addEventListener('click', () => {
                const bet = parseInt(betSelect.value);
                const totalBet = bet;

                reels.forEach(reel => gsap.set(reel, { scale: 1, backgroundColor: "#333" }));
                winCounter.style.display = 'none';

                if (balance >= totalBet) {
                    balance -= totalBet;
                    updateMoneyCounter();

                    animateReels().then(() => {
                        const results = spinReels();
                        const { winAmount, winningSymbols } = checkWin(results);

                        if (winAmount > 0) {
                            balance += winAmount;
                            resultMessage.textContent = `Wygra≈Çe≈õ ${winAmount.toFixed(2)} PLN!`;
                            winCounter.textContent = `Wygrana: ${winAmount.toFixed(2)} PLN`;
                            winCounter.style.display = 'block';
                            animateWinningSymbols(winningSymbols);
                        } else {
                            resultMessage.textContent = "Brak wygranej, spr√≥buj ponownie!";
                        }

                        updateMoneyCounter();
                    });
                } else {
                    resultMessage.textContent = "Brak wystarczajƒÖcych ≈õrodk√≥w!";
                }
            });

            addMoneyButton.addEventListener('click', () => {
                balance += 10;
                updateMoneyCounter();
            });

            updateMoneyCounter();
        });
    </script>
</body>
</html>
